var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,r)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__spreadValues=(e,t)=>{for(var r in t||(t={}))__hasOwnProp.call(t,r)&&__defNormalProp(e,r,t[r]);if(__getOwnPropSymbols)for(var r of __getOwnPropSymbols(t))__propIsEnum.call(t,r)&&__defNormalProp(e,r,t[r]);return e},__spreadProps=(e,t)=>__defProps(e,__getOwnPropDescs(t));!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("codemirror"),require("codemirror/lib/codemirror.css"),require("vue"),require("codemirror/addon/merge/merge.css"),require("codemirror/addon/merge/merge.js"),require("diff-match-patch"),require("codemirror/addon/mode/simple.js"),require("codemirror/lib/codemirror.js")):"function"==typeof define&&define.amd?define(["exports","codemirror","codemirror/lib/codemirror.css","vue","codemirror/addon/merge/merge.css","codemirror/addon/merge/merge.js","diff-match-patch","codemirror/addon/mode/simple.js","codemirror/lib/codemirror.js"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["codemirror-editor-vue3"]={},e.codemirror,null,e.Vue,null,null,e.DiffMatchPatch,null,e.codemirror)}(this,(function(e,t,r,n,o,a,l,i,c){"use strict";function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function u(e){if(e&&e.__esModule)return e;var t={__proto__:null,[Symbol.toStringTag]:"Module"};return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var d=s(t),p=s(l),m=u(c);const g=window.CodeMirror||d.default,f=n.defineComponent({name:"codemirror",props:{code:String,value:String,content:String,options:{type:Object,default:()=>({})},cminstance:{type:Object,default:()=>({})},placeholder:{type:String,default:""}},emits:["update:cminstance","ready"],setup(e,{emit:t}){const r=n.ref(),o=n.ref(null),a=()=>{o.value=n.markRaw(g.fromTextArea(r.value,e.options)),t("update:cminstance",n.markRaw(o.value));let a=null;a=n.watch((()=>e.cminstance),((r,n)=>{r&&e.cminstance.setValue(e.code||e.value||e.content),t("ready",o),a()}),{deep:!0})};return n.onMounted((()=>{a()})),{initialize:a,textarea:r}}}),h=["name","placeholder"];f.render=function(e,t,r,o,a,l){return n.openBlock(),n.createElementBlock("textarea",{ref:"textarea",name:e.$props.name,placeholder:e.$props.placeholder},null,8,h)};const v=window.CodeMirror||d.default;window.diff_match_patch=p.default,window.DIFF_DELETE=-1,window.DIFF_INSERT=1,window.DIFF_EQUAL=0;const y=n.defineComponent({name:"mergemode",props:{options:{type:Object,default:()=>({})},cminstance:{type:Object,default:()=>({})},height:{type:[String,Number],default:null}},emits:["update:cminstance","ready"],setup(e,{emit:t}){const r=n.ref(null),o=n.ref(null);String(e.height).replace("px","");const a=()=>{r.value=n.markRaw(v.MergeView(o.value,e.options)),t("update:cminstance",n.markRaw(r.value.edit)),t("ready",r)};return n.onMounted((()=>{a()})),{mergeView:o,initialize:a}}}),b={ref:"mergeView"};var w,_;function k(){const e=new Date;return`${e.getHours()<10?"0"+e.getHours():e.getHours()}:${e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes()}:${e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds()}`}function O(e){const t=/#link#(.+)#link#/g;let r,n=[];for(r=t.exec(e);r;){const o=document.createElement("a"),a=JSON.parse(r[1]),l=Object.entries(a);for(let[e,t]of l)o.setAttribute(e,t);o.className="editor_custom_link",o.innerHTML="logDownload",n.push({start:r.index,end:r.index+r[0].length,node:o}),r=t.exec(e)}return n}function x(e){let t=[];return function(){const r=new RegExp("#log<(\\w*)>log#((.|\r\n|\n)*?)#log<(\\w*)>log#","g");let n;for(n=r.exec(e);n;){let o=n[0].replace(/\r\n/g,"\n").split("\n"),a=n[2].replace(/\r\n/g,"\n").split("\n");const l=document.createElement("span");let i=n[1];l.className=`c-editor--log__${i}`;let c=0;for(let e=0;e<o.length;e++){let r=o[e],i=a[e],s=l.cloneNode(!1);s.innerText=i,t.push({start:n.index+c,end:n.index+c+r.length,node:s}),c=c+r.length+1}n=r.exec(e)}}(),t}y.render=function(e,t,r,o,a,l){return n.openBlock(),n.createElementBlock("div",b,null,512)},(_=w||(w={})).info="info",_.warning="warning",_.error="error";const S=[{regex:/(\[.*?\])([ \t]*)(<error>[ \t])(.+)/,token:["tag",null,"error.strong","error.strong"],sol:!0},{regex:/(\[.*?\])([ \t]*)(<info>)(.+)(.?)/,token:["tag",null,"bracket","bracket","hr"],sol:!0},{regex:/(\[.*?\])([ \t]*)(<warning>)(.+)(.?)/,token:["tag",null,"comment","comment","hr"],sol:!0}];d.default.defineSimpleMode("fclog",{start:[...S,{regex:/.*/,token:"hr"}],error:[...S,{regex:/.*/,token:"error.strong"}],info:[...S,{regex:/.*/,token:"bracket"}],warning:[...S,{regex:/.*\[/,token:"comment"}]}),m.defineSimpleMode("log",{start:[{regex:/^[=]+[^=]*[=]+/,token:"strong"},{regex:/([^\w])([A-Z][\w]*)/,token:[null,"string"]},{regex:/(^[A-Z][\w]*)/,token:"string"}]});const j=window.CodeMirror||d.default,M=n.defineComponent({name:"codemirror-fclog",props:{code:String,value:String,content:String,options:{type:Object,default:()=>({})},cminstance:{type:Object,default:()=>({})},placeholder:{type:String,default:""},KeepCursorInEnd:{type:Boolean,default:!0}},emits:["update:cminstance","ready"],setup(e,{emit:t}){const r=n.ref(),o=n.ref(null),a=n.computed((()=>e.KeepCursorInEnd)),l=(t=e.cminstance)=>{t.getAllMarks().forEach((e=>e.clear()));const r=t.getValue(),n=[].concat(O(r)).concat(x(r));for(let e=0;e<n.length;e++){const r=n[e];t.markText(t.posFromIndex(r.start),t.posFromIndex(r.end),{replacedWith:r.node})}},i=()=>{o.value=n.markRaw(j.fromTextArea(r.value,e.options)),t("update:cminstance",n.markRaw(o.value)),o.value.on("change",(t=>{l(),a&&Promise.resolve().then((()=>{let t=e.cminstance.getScrollInfo();e.cminstance.scrollTo(t.left,t.height)}))}))};return n.watch((()=>e.cminstance),(r=>{r&&(l(e.cminstance),e.cminstance.setValue(e.code||e.value||e.content),t("ready",o))}),{deep:!0,immediate:!0}),n.onMounted((()=>{i()})),{initialize:i,textarea:r}}}),E=["name","placeholder"];M.render=function(e,t,r,o,a,l){return n.openBlock(),n.createElementBlock("textarea",{ref:"textarea",name:e.$props.name,placeholder:e.$props.placeholder},null,8,E)},"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");const r=Object(e);for(let n=1;n<arguments.length;n++){const e=arguments[n];if(null!=e)for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t])}return r},writable:!0,configurable:!0});const P={mode:"text",theme:"default",lineNumbers:!0,smartIndent:!0,indentUnit:2,foldGutter:!0,matchBrackets:!0,autoCloseBrackets:!0,styleActiveLine:!0},$=["update:value","change","input","ready"],C=n.defineComponent({name:"CodemirrorEditor",props:{code:String,value:String,marker:Function,unseenLines:Array,name:{type:String,default:""},placeholder:{type:String,default:""},merge:{type:Boolean,default:!1},options:{type:Object,default:()=>({})},globalOptions:{type:Object,default:()=>({})},border:{type:Boolean,default:!1},width:{type:[String,Number],default:null},height:{type:[String,Number],default:null},KeepCursorInEnd:{type:Boolean,default:!1}},emits:[...$,"changes","scroll","beforeChange","cursorActivity","keyHandled","inputRead","electricInput","beforeSelectionChange","viewportChange","swapDoc","gutterClick","gutterContextMenu","focus","blur","refresh","optionChange","scrollCursorIntoView","update"],components:{Default:f,Merge:y,FcLog:M},setup(e,t){var r,o;const a=n.ref(null),l=n.ref(""),i=n.ref("Default"),c=n.ref(Object.assign(__spreadValues({},P),e.globalOptions,e.options)),s=n.getCurrentInstance(),u=n.ref(null),d=n.ref(null),p=n.ref(null),m=(t=e.width,r=e.height)=>{d.value=String(t).replace("px",""),p.value=String(r).replace("px","");let n=p.value;e.merge&&(n-=2),a.value.setSize(d.value,n)},g=()=>{void 0!==e.unseenLines&&void 0!==marker&&e.unseenLines.forEach((e=>{const t=a.value.lineInfo(e);a.value.setGutterMarker(e,"breakpoints",t.gutterMarkers?null:marker())}))},{listenerEvents:f}=function({cminstance:e,ctx:t,internalInstance:r,content:n}){const o=()=>{let e=[];return Object.keys(r.vnode.props).forEach((t=>{if(t.startsWith("on")){let r=t.replace(t[2],t[2].toLowerCase()).slice(2);!$.includes(r)&&e.push(r)}})),e};return{listenerEvents:()=>{e.value.on("change",(e=>{const r=e.getValue();r!=n.value&&(n.value=r,t.emit("update:value",n.value),t.emit("input",n.value),t.emit("change",n.value,e))}));const r={};return o().filter((e=>!r[e]&&(r[e]=!0))).forEach((r=>{e.value.on(r,((...e)=>{t.emit(r,...e)}))}))}}}({cminstance:a,ctx:t,internalInstance:s,content:l});n.watch((()=>e.options),(t=>{for(const r in e.options)a.value.setOption(r,t[r])}),{deep:!0}),n.watch((()=>e.value),(e=>{(e=>{if(e!==a.value.getValue()){const t=a.value.getScrollInfo();a.value.setValue(e),l.value=e,a.value.scrollTo(t.left,t.top)}g()})(e)}));return n.watch((()=>e.merge),(t=>{"fclog"!=e.options.mode&&"log"!=e.options.mode?e.merge?i.value="Merge":i.value="default":i.value="FcLog"}),{immediate:!0}),n.onBeforeUnmount((()=>{(()=>{const e=a.value.doc.cm.getWrapperElement();null==e||e.remove()})()})),{presetModeName:i,cmOptions:c,cminstance:a,content:l,ready:r=>{f(),g(),m(),t.emit("ready",a.value),n.watch([()=>e.height,()=>e.width],(([e,t])=>{m(e,t)}),{deep:!0})},resize:m,containerWidth:d,containerHeight:p,instanceName:e.name||(null==(o=null==(r=null==s?void 0:s.parent)?void 0:r.type)?void 0:o.name)+"-cm",presetRef:u}}});C.render=function(e,t,r,o,a,l){return n.openBlock(),n.createElementBlock("div",{class:n.normalizeClass(["codemirror-container",{merge:e.$props.merge,bordered:!e.$props.merge&&e.$props.border,"width-auto":!e.$props.width||"100%"==e.$props.width,"height-auto":!e.$props.height||"100%"==e.$props.height}]),style:n.normalizeStyle({height:e.containerHeight+"px"})},[(n.openBlock(),n.createBlock(n.resolveDynamicComponent(e.presetModeName),n.mergeProps({style:{height:"100%"},ref:"presetRef",cminstance:e.cminstance,"onUpdate:cminstance":t[0]||(t[0]=t=>e.cminstance=t)},__spreadProps(__spreadValues(__spreadValues({},e.$props),e.$attrs),{options:e.cmOptions,name:e.instanceName,content:e.content}),{onReady:e.ready}),null,16,["cminstance","onReady"]))],6)};C.install=(e,t)=>(t&&(t.options&&(C.props.globalOptions.default=()=>t.options),t.events&&(C.props.globalEvents.default=()=>t.events)),e.component("Codemirror",C),e),e.Codemirror=C,e.createLinkMark=function(e){return`#link#${JSON.stringify(e)}#link#`},e.createLog=function(e,t=""){return`[${k()}] <${t}> ${e}`},e.createLogMark=function(e="",t="info"){return`#log<${t}>log#${e}#log<${t}>log#`},e.createTitle=function(e="",t=20,r="="){const n=Math.floor(1.5*e.length/2),o=new Array(Math.max(t-n,5)).join(r);return`${o}${e}${o}`},e.default=C,e.getLinkMark=O,e.getLocalTime=k,e.getLogMark=x,Object.defineProperty(e,"__esModule",{value:!0}),e[Symbol.toStringTag]="Module"}));
